# Иструкция

ответы на вопросы которые как я предпологаю могут возникнуть, сделано для удобства проверки:

запуск: docker-compose -f docker-compose.yml up -d

swagger ui: http://localhost:8080/swagger/index.html

при запуске в консоли выводятся uuid всех созданых пользователя. пример вывода:

2025-07-28 21:15:01 golang_app   | ===================================

2025-07-28 21:15:01 golang_app   | d504fd34-5ca7-4493-b160-ce160dd9e2af

2025-07-28 21:15:01 golang_app   | ===================================

их можно использовать для авторизации.  
==================
# принципы работы методов:
## login
ищет данные в таблице пользователей в базе данных по uuid, создаёт jwt с заданным временем создания, временем до которого он действителен и uuid пользователя, генерирует uuid для рефреш токена, хеширует, добавляет данные user-agent и ip из данных запроса, и uuid пользователя, сохраняет, и возвращает незахешированый рефреш, закодированый в base64 и jwt.
## refresh
получает пользователя по данным из jwt, по uuid получает рефреш токены пользователя, ищет нужный рефреш сравнивая хеш рефрешей и полученый рефреш, если не нашёл то возвращает ошибку, если всё ок, то сравнивает время создания jwt и refresh, и сравнивает user_agent старого и нового рефреша, если не совпадает то деавторизует пользователя(путём удаления у пользователя всех рефреш токенов), если совпадает, то обновляет все токены с таким же user agent, ip, и пользователем, если же не 1 не обновился, создаёт его.
## logout
запрос с авторизацией(требуется установленный header Authorization который содержит jwt в виде "Bearer {token}"). получает jwt, проверяет его, потом из него получает данные о пользователе, и удаляет все рефреш токены у него
## getUUID
 запрос с авторизацией(требуется установленный header Authorization который содержит jwt в виде "Bearer {token}"). получает jwt, проверяет его, потом из него получает данные о пользователе, после ищет пользователя в базе данных по полученым данным из jwt и возвращает их(не смотря на то, что единственные данные у пользователя из данных только uuid, который храниться в jwt, запрос к базе данных делается исходя из того что у него могут появиться доп поля в будущем, которые так же надо будет получать)
# пояснения к авторизации:
 сам механизм авторизации происходит через jwt_middleware, проверяет наличие header Authorization, получается токен, после чего проверяет наличие у пользователя рефреш токенов в бд, если их нет то он считается разлогиненым, и, следовательно, возвращается ошибка. если всё норм то запрос передаётся дальше в ендпоинт.
